<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instructional Farm Collage Maker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Custom font classes matching the handwriting style in the image */
        .font-hand {
            font-family: 'Patrick Hand', cursive;
        }
        .print-preview-shadow {
            box-shadow: 0 0 20px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef } = React;

        // Icon components using SVG
        const UploadIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mx-auto mb-2 text-gray-400">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
        );

        const DownloadIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mr-2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
        );

        // Editable Image Component
        const ImageSlot = ({ id, label, aspectRatio, image, onUpload, onLabelChange }) => {
            const fileInputRef = useRef(null);

            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        onUpload(id, event.target.result);
                    };
                    reader.readAsDataURL(file);
                }
            };

            return (
                <div className="flex flex-col items-center">
                    <div 
                        className={`relative w-full overflow-hidden bg-gray-100 border-2 border-dashed border-gray-300 hover:border-blue-400 transition-colors cursor-pointer group rounded-sm`}
                        style={{ aspectRatio: aspectRatio }}
                        onClick={() => fileInputRef.current.click()}
                    >
                        {image ? (
                            <img src={image} alt={label} className="w-full h-full object-cover" />
                        ) : (
                            <div className="absolute inset-0 flex flex-col items-center justify-center p-4 text-center">
                                <UploadIcon />
                                <span className="text-xs text-gray-500 font-medium">Click to Upload</span>
                            </div>
                        )}
                        
                        {/* Overlay for re-uploading */}
                        <div className="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 transition-all flex items-center justify-center">
                            {image && <span className="opacity-0 group-hover:opacity-100 bg-white px-2 py-1 rounded text-xs font-bold shadow">Change</span>}
                        </div>

                        <input 
                            type="file" 
                            ref={fileInputRef} 
                            className="hidden" 
                            accept="image/*" 
                            onChange={handleFileChange} 
                        />
                    </div>
                    <input 
                        value={label} 
                        onChange={(e) => onLabelChange(id, e.target.value)}
                        className="mt-1 w-full text-center font-hand text-lg md:text-xl bg-transparent border-b border-transparent hover:border-gray-300 focus:border-blue-500 focus:outline-none transition-colors"
                    />
                </div>
            );
        };

        const App = () => {
            const printRef = useRef(null);
            const [isGenerating, setIsGenerating] = useState(false);

            // Initial State for Images and Labels
            const [data, setData] = useState({
                main: { img: null, label: "Paddy field" },
                row1_1: { img: null, label: "Harvesting of paddy" },
                row1_2: { img: null, label: "Harvesting in group" },
                row1_3: { img: null, label: "Threshing of paddy" },
                row2_1: { img: null, label: "Winnowing" },
                row2_2: { img: null, label: "Weighing of grain" },
                row2_3: { img: null, label: "Weighing of straw" },
            });

            // Initial State for Text Fields
            const [groupName, setGroupName] = useState("Group A");
            const [rollNos, setRollNos] = useState("Roll No. 1, 2, 3 ........... 10");
            const [projectTitle, setProjectTitle] = useState("HARVESTING , THRESHING AND WINNOWING OF PADDY AT INSTRUCTIONAL FARM, B.C.K.V., JAGULI, NADIA.");

            const handleUpload = (id, imgData) => {
                setData(prev => ({
                    ...prev,
                    [id]: { ...prev[id], img: imgData }
                }));
            };

            const handleLabelChange = (id, newLabel) => {
                setData(prev => ({
                    ...prev,
                    [id]: { ...prev[id], label: newLabel }
                }));
            };

            const generateFile = async (type) => {
                if (!printRef.current) return;
                setIsGenerating(true);

                try {
                    // Slight delay to ensure renders are settled
                    await new Promise(resolve => setTimeout(resolve, 100));

                    const canvas = await html2canvas(printRef.current, {
                        scale: 2, // Higher scale for better quality
                        useCORS: true,
                        logging: false,
                        backgroundColor: "#ffffff"
                    });

                    if (type === 'pdf') {
                        const { jsPDF } = window.jspdf;
                        const imgData = canvas.toDataURL('image/jpeg', 1.0);
                        // A4 size: 210mm x 297mm
                        const pdf = new jsPDF('p', 'mm', 'a4');
                        const pdfWidth = pdf.internal.pageSize.getWidth();
                        const pdfHeight = pdf.internal.pageSize.getHeight();
                        
                        // Calculate resizing to fit A4
                        const imgProps = pdf.getImageProperties(imgData);
                        const ratio = imgProps.width / imgProps.height;
                        const pdfRatio = pdfWidth / pdfHeight;
                        
                        let w, h;
                        // Fit to width mostly, but ensure height fits too
                        w = pdfWidth;
                        h = w / ratio;
                        
                        if (h > pdfHeight) {
                           h = pdfHeight;
                           w = h * ratio;
                        }

                        pdf.addImage(imgData, 'JPEG', 0, 0, w, h);
                        pdf.save('paddy-field-report.pdf');
                    } else {
                        const link = document.createElement('a');
                        link.download = `paddy-field-collage.${type}`;
                        link.href = canvas.toDataURL(`image/${type}`, 1.0);
                        link.click();
                    }
                } catch (err) {
                    console.error("Export failed", err);
                    alert("Failed to export image. Please try again.");
                } finally {
                    setIsGenerating(false);
                }
            };

            return (
                <div className="flex flex-col items-center p-4 md:p-8">
                    {/* Toolbar */}
                    <div className="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-white shadow-xl rounded-full px-6 py-3 flex gap-4 z-50 items-center border border-gray-200">
                        <span className="text-sm font-semibold text-gray-600 hidden md:inline">Export As:</span>
                        <button 
                            onClick={() => generateFile('jpeg')}
                            disabled={isGenerating}
                            className="flex items-center text-sm font-medium px-3 py-1.5 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition disabled:opacity-50"
                        >
                            <DownloadIcon /> JPEG
                        </button>
                        <button 
                            onClick={() => generateFile('png')}
                            disabled={isGenerating}
                            className="flex items-center text-sm font-medium px-3 py-1.5 bg-green-600 text-white rounded-md hover:bg-green-700 transition disabled:opacity-50"
                        >
                            <DownloadIcon /> PNG
                        </button>
                        <button 
                            onClick={() => generateFile('pdf')}
                            disabled={isGenerating}
                            className="flex items-center text-sm font-medium px-3 py-1.5 bg-red-600 text-white rounded-md hover:bg-red-700 transition disabled:opacity-50"
                        >
                            <DownloadIcon /> PDF
                        </button>
                    </div>

                    <div className="mb-6 text-center">
                        <h1 className="text-2xl font-bold text-gray-800">Project Collage Maker</h1>
                        <p className="text-gray-500">Click images to upload. Click text to edit.</p>
                    </div>

                    {/* A4 Canvas Container */}
                    {/* Aspect Ratio for A4 is roughly 1:1.414 */}
                    <div className="w-full max-w-3xl overflow-auto">
                        <div 
                            ref={printRef}
                            id="print-area"
                            className="bg-white mx-auto print-preview-shadow relative flex flex-col justify-between"
                            style={{ 
                                width: '794px', 
                                height: '1123px', /* Standard A4 at 96 DPI pixel equivalent approx, scaled down visually by CSS if needed */
                                padding: '40px' 
                            }}
                        >
                            {/* Inner Content Border */}
                            <div className="border-2 border-black w-full h-full flex flex-col p-6 relative">
                                
                                {/* Top Section: Main Image */}
                                <div className="mb-6 px-12">
                                    <ImageSlot 
                                        id="main"
                                        label={data.main.label}
                                        aspectRatio="2.5/1"
                                        image={data.main.img}
                                        onUpload={handleUpload}
                                        onLabelChange={handleLabelChange}
                                    />
                                </div>

                                {/* Middle Section: Grid of 6 */}
                                <div className="grid grid-cols-3 gap-x-6 gap-y-8 px-2 mb-8">
                                    {/* Row 1 */}
                                    <ImageSlot 
                                        id="row1_1"
                                        label={data.row1_1.label}
                                        aspectRatio="3/4"
                                        image={data.row1_1.img}
                                        onUpload={handleUpload}
                                        onLabelChange={handleLabelChange}
                                    />
                                    <ImageSlot 
                                        id="row1_2"
                                        label={data.row1_2.label}
                                        aspectRatio="3/4"
                                        image={data.row1_2.img}
                                        onUpload={handleUpload}
                                        onLabelChange={handleLabelChange}
                                    />
                                    <ImageSlot 
                                        id="row1_3"
                                        label={data.row1_3.label}
                                        aspectRatio="3/4"
                                        image={data.row1_3.img}
                                        onUpload={handleUpload}
                                        onLabelChange={handleLabelChange}
                                    />

                                    {/* Row 2 */}
                                    <ImageSlot 
                                        id="row2_1"
                                        label={data.row2_1.label}
                                        aspectRatio="3/4"
                                        image={data.row2_1.img}
                                        onUpload={handleUpload}
                                        onLabelChange={handleLabelChange}
                                    />
                                    <ImageSlot 
                                        id="row2_2"
                                        label={data.row2_2.label}
                                        aspectRatio="3/4"
                                        image={data.row2_2.img}
                                        onUpload={handleUpload}
                                        onLabelChange={handleLabelChange}
                                    />
                                    <ImageSlot 
                                        id="row2_3"
                                        label={data.row2_3.label}
                                        aspectRatio="3/4"
                                        image={data.row2_3.img}
                                        onUpload={handleUpload}
                                        onLabelChange={handleLabelChange}
                                    />
                                </div>

                                {/* Bottom Text Section */}
                                <div className="mt-auto text-center space-y-4">
                                    <div className="flex justify-center items-center gap-2 font-hand text-xl md:text-2xl">
                                        <input 
                                            value={groupName}
                                            onChange={(e) => setGroupName(e.target.value)}
                                            className="text-right font-bold bg-transparent focus:outline-none border-b border-transparent hover:border-gray-300 w-1/3"
                                        />
                                        <span>:</span>
                                        <input 
                                            value={rollNos}
                                            onChange={(e) => setRollNos(e.target.value)}
                                            className="text-left bg-transparent focus:outline-none border-b border-transparent hover:border-gray-300 w-1/2"
                                        />
                                    </div>

                                    <div className="px-8">
                                        <textarea 
                                            value={projectTitle}
                                            onChange={(e) => setProjectTitle(e.target.value)}
                                            rows="3"
                                            className="w-full text-center font-hand text-xl md:text-2xl uppercase tracking-wide bg-transparent focus:outline-none resize-none overflow-hidden border border-transparent hover:border-gray-300 rounded"
                                            style={{ lineHeight: '1.5' }}
                                        />
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    
                    <div className="h-24 md:h-12 w-full"></div> {/* Spacer for fixed footer */}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

