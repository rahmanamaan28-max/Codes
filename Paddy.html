<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instructional Farm Collage Maker (Half A4)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        .font-hand {
            font-family: 'Patrick Hand', cursive;
        }
        .print-preview-shadow {
            box-shadow: 0 0 20px rgba(0,0,0,0.15);
        }
        /* Hide scrollbar for cleaner UI */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="bg-gray-200 min-h-screen text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef } = React;

        const UploadIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mx-auto mb-1 text-gray-400">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
        );

        const DownloadIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mr-2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
        );

        const ImageSlot = ({ id, label, aspectRatio, image, onUpload, onLabelChange }) => {
            const fileInputRef = useRef(null);

            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        onUpload(id, event.target.result);
                    };
                    reader.readAsDataURL(file);
                }
            };

            return (
                <div className="flex flex-col items-center w-full">
                    <div 
                        className={`relative w-full overflow-hidden bg-gray-50 border border-dashed border-gray-300 hover:border-blue-400 transition-colors cursor-pointer group rounded-sm`}
                        style={{ aspectRatio: aspectRatio }}
                        onClick={() => fileInputRef.current.click()}
                    >
                        {image ? (
                            <img src={image} alt={label} className="w-full h-full object-cover" />
                        ) : (
                            <div className="absolute inset-0 flex flex-col items-center justify-center p-2 text-center">
                                <UploadIcon />
                                <span className="text-[10px] text-gray-400 font-medium">Upload</span>
                            </div>
                        )}
                        <div className="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 transition-all flex items-center justify-center">
                            {image && <span className="opacity-0 group-hover:opacity-100 bg-white px-1.5 py-0.5 rounded text-[10px] font-bold shadow">Edit</span>}
                        </div>
                        <input 
                            type="file" 
                            ref={fileInputRef} 
                            className="hidden" 
                            accept="image/*" 
                            onChange={handleFileChange} 
                        />
                    </div>
                    <input 
                        value={label} 
                        onChange={(e) => onLabelChange(id, e.target.value)}
                        className="mt-0.5 w-full text-center font-hand text-sm bg-transparent border-b border-transparent hover:border-gray-300 focus:border-blue-500 focus:outline-none transition-colors leading-tight"
                    />
                </div>
            );
        };

        const App = () => {
            const printRef = useRef(null);
            const [isGenerating, setIsGenerating] = useState(false);

            const [data, setData] = useState({
                main: { img: null, label: "Paddy field" },
                row1_1: { img: null, label: "Harvesting of paddy" },
                row1_2: { img: null, label: "Harvesting in group" },
                row1_3: { img: null, label: "Threshing of paddy" },
                row2_1: { img: null, label: "Winnowing" },
                row2_2: { img: null, label: "Weighing of grain" },
                row2_3: { img: null, label: "Weighing of straw" },
            });

            const [groupName, setGroupName] = useState("Group A");
            const [rollNos, setRollNos] = useState("Roll No. 1, 2, 3 ........... 10");
            const [projectTitle, setProjectTitle] = useState("HARVESTING , THRESHING AND WINNOWING OF PADDY AT INSTRUCTIONAL FARM, B.C.K.V., JAGULI, NADIA.");

            const handleUpload = (id, imgData) => {
                setData(prev => ({ ...prev, [id]: { ...prev[id], img: imgData } }));
            };

            const handleLabelChange = (id, newLabel) => {
                setData(prev => ({ ...prev, [id]: { ...prev[id], label: newLabel } }));
            };

            const generateFile = async (type) => {
                if (!printRef.current) return;
                setIsGenerating(true);

                try {
                    await new Promise(resolve => setTimeout(resolve, 100));

                    const canvas = await html2canvas(printRef.current, {
                        scale: 3, 
                        useCORS: true,
                        backgroundColor: "#ffffff"
                    });

                    if (type === 'pdf') {
                        const { jsPDF } = window.jspdf;
                        const imgData = canvas.toDataURL('image/jpeg', 1.0);
                        
                        // Standard A4 Portrait (210mm x 297mm)
                        const pdf = new jsPDF('p', 'mm', 'a4');
                        const pdfWidth = pdf.internal.pageSize.getWidth();
                        
                        // We want to print it at the top half.
                        // Add some margin (e.g., 10mm)
                        const margin = 10;
                        const printWidth = pdfWidth - (margin * 2);
                        
                        // Calculate height based on image ratio
                        const imgProps = pdf.getImageProperties(imgData);
                        const ratio = imgProps.width / imgProps.height;
                        const printHeight = printWidth / ratio;

                        pdf.addImage(imgData, 'JPEG', margin, margin, printWidth, printHeight);
                        pdf.save('paddy-field-collage.pdf');
                    } else {
                        const link = document.createElement('a');
                        link.download = `paddy-field-collage.${type}`;
                        link.href = canvas.toDataURL(`image/${type}`, 1.0);
                        link.click();
                    }
                } catch (err) {
                    console.error("Export failed", err);
                    alert("Export failed.");
                } finally {
                    setIsGenerating(false);
                }
            };

            return (
                <div className="flex flex-col items-center p-4">
                    {/* Toolbar */}
                    <div className="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-white shadow-2xl rounded-full px-5 py-2.5 flex gap-3 z-50 items-center border border-gray-200">
                        <button 
                            onClick={() => generateFile('jpeg')}
                            disabled={isGenerating}
                            className="flex items-center text-xs font-bold px-3 py-1.5 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition disabled:opacity-50"
                        >
                            JPG
                        </button>
                        <button 
                            onClick={() => generateFile('png')}
                            disabled={isGenerating}
                            className="flex items-center text-xs font-bold px-3 py-1.5 bg-green-600 text-white rounded-full hover:bg-green-700 transition disabled:opacity-50"
                        >
                            PNG
                        </button>
                        <button 
                            onClick={() => generateFile('pdf')}
                            disabled={isGenerating}
                            className="flex items-center text-xs font-bold px-3 py-1.5 bg-red-600 text-white rounded-full hover:bg-red-700 transition disabled:opacity-50"
                        >
                            PDF
                        </button>
                    </div>

                    <div className="mb-4 text-center">
                        <h1 className="text-xl font-bold text-gray-800">Compact Collage Maker</h1>
                        <p className="text-xs text-gray-500">Fits perfectly on half an A4 page.</p>
                    </div>

                    {/* Canvas Container */}
                    <div className="overflow-auto w-full flex justify-center pb-20">
                        {/* Dimensions: 794px width (A4 width at 96dpi) 
                           Height: ~560px (Half A4 height)
                        */}
                        <div 
                            ref={printRef}
                            id="print-area"
                            className="bg-white print-preview-shadow relative flex flex-col items-center justify-center shrink-0"
                            style={{ 
                                width: '794px', 
                                height: '561px', 
                                padding: '20px' 
                            }}
                        >
                            {/* Inner Content Border Box */}
                            <div className="border border-black w-full h-full flex flex-col p-3 relative max-w-2xl mx-auto">
                                
                                {/* Top Image */}
                                <div className="mb-3 px-8">
                                    <ImageSlot 
                                        id="main"
                                        label={data.main.label}
                                        aspectRatio="4/1" 
                                        image={data.main.img}
                                        onUpload={handleUpload}
                                        onLabelChange={handleLabelChange}
                                    />
                                </div>

                                {/* Image Grid (Tighter Spacing) */}
                                <div className="grid grid-cols-3 gap-2 px-1 mb-3">
                                    <ImageSlot 
                                        id="row1_1" label={data.row1_1.label} aspectRatio="4/3"
                                        image={data.row1_1.img} onUpload={handleUpload} onLabelChange={handleLabelChange}
                                    />
                                    <ImageSlot 
                                        id="row1_2" label={data.row1_2.label} aspectRatio="4/3"
                                        image={data.row1_2.img} onUpload={handleUpload} onLabelChange={handleLabelChange}
                                    />
                                    <ImageSlot 
                                        id="row1_3" label={data.row1_3.label} aspectRatio="4/3"
                                        image={data.row1_3.img} onUpload={handleUpload} onLabelChange={handleLabelChange}
                                    />
                                    <ImageSlot 
                                        id="row2_1" label={data.row2_1.label} aspectRatio="4/3"
                                        image={data.row2_1.img} onUpload={handleUpload} onLabelChange={handleLabelChange}
                                    />
                                    <ImageSlot 
                                        id="row2_2" label={data.row2_2.label} aspectRatio="4/3"
                                        image={data.row2_2.img} onUpload={handleUpload} onLabelChange={handleLabelChange}
                                    />
                                    <ImageSlot 
                                        id="row2_3" label={data.row2_3.label} aspectRatio="4/3"
                                        image={data.row2_3.img} onUpload={handleUpload} onLabelChange={handleLabelChange}
                                    />
                                </div>

                                {/* Footer Text */}
                                <div className="mt-auto space-y-2 text-center">
                                    <div className="flex justify-center gap-1 font-hand text-base font-bold">
                                        <input 
                                            value={groupName}
                                            onChange={(e) => setGroupName(e.target.value)}
                                            className="text-right bg-transparent focus:outline-none w-1/3 hover:bg-gray-50"
                                        />
                                        <span>:</span>
                                        <input 
                                            value={rollNos}
                                            onChange={(e) => setRollNos(e.target.value)}
                                            className="text-left bg-transparent focus:outline-none w-1/2 hover:bg-gray-50"
                                        />
                                    </div>

                                    <div className="px-4">
                                        <textarea 
                                            value={projectTitle}
                                            onChange={(e) => setProjectTitle(e.target.value)}
                                            rows="2"
                                            className="w-full text-center font-hand text-sm uppercase font-bold tracking-wide bg-transparent focus:outline-none resize-none overflow-hidden hover:bg-gray-50 rounded"
                                            style={{ lineHeight: '1.2' }}
                                        />
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
