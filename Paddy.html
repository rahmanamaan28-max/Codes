<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Project Collage Maker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
    <style>
        .font-hand {
            font-family: 'Patrick Hand', cursive;
        }
        /* Custom file input trigger styling */
        .image-upload-trigger:hover .upload-overlay {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen text-gray-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef } = React;

        // --- COMPONENTS ---

        const ImageBox = ({ id, label, aspectRatio, image, onUpload, onLabelChange, className }) => {
            const fileInputRef = useRef(null);

            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => onUpload(id, event.target.result);
                    reader.readAsDataURL(file);
                }
            };

            return (
                <div className={`flex flex-col items-center ${className}`}>
                    {/* Image Container */}
                    <div 
                        className="relative w-full border border-gray-300 bg-gray-50 cursor-pointer overflow-hidden image-upload-trigger hover:border-blue-500 transition-colors"
                        style={{ aspectRatio: aspectRatio }}
                        onClick={() => fileInputRef.current.click()}
                    >
                        {image ? (
                            <img src={image} alt={label} className="w-full h-full object-cover" />
                        ) : (
                            <div className="absolute inset-0 flex items-center justify-center">
                                <span className="text-gray-300 text-4xl font-light">+</span>
                            </div>
                        )}
                        
                        {/* Hover Overlay */}
                        <div className="upload-overlay absolute inset-0 bg-black bg-opacity-20 flex items-center justify-center opacity-0 transition-opacity">
                            <span className="text-white text-xs font-bold bg-black bg-opacity-50 px-2 py-1 rounded">Change</span>
                        </div>
                        
                        <input 
                            type="file" 
                            ref={fileInputRef} 
                            className="hidden" 
                            accept="image/*" 
                            onChange={handleFileChange} 
                        />
                    </div>
                    
                    {/* Label Input */}
                    <input 
                        value={label}
                        onChange={(e) => onLabelChange(id, e.target.value)}
                        className="w-full text-center bg-transparent border-none focus:ring-0 font-hand text-lg leading-tight mt-1 p-0 text-gray-800 placeholder-gray-400"
                        placeholder="Label..."
                    />
                </div>
            );
        };

        const App = () => {
            const printRef = useRef(null);
            const [isGenerating, setIsGenerating] = useState(false);

            // Data State
            const [images, setImages] = useState({
                main: null,
                g1: null, g2: null, g3: null,
                g4: null, g5: null, g6: null
            });

            const [labels, setLabels] = useState({
                main: "Paddy field",
                g1: "Harvesting of paddy", g2: "Harvesting in group", g3: "Threshing of paddy",
                g4: "Winnowing", g5: "Weighing of grain", g6: "Weighing of straw"
            });

            const [footer, setFooter] = useState({
                group: "Group A",
                roll: "Roll No. 1, 2, 3 ........... 10",
                desc: "HARVESTING , THRESHING AND WINNOWING OF PADDY AT INSTRUCTIONAL FARM, B.C.K.V., JAGULI, NADIA."
            });

            // Handlers
            const handleUpload = (id, data) => setImages(prev => ({...prev, [id]: data}));
            const handleLabelChange = (id, val) => setLabels(prev => ({...prev, [id]: val}));
            
            const handleDownload = async (format) => {
                if (!printRef.current) return;
                setIsGenerating(true);

                try {
                    // Wait for render
                    await new Promise(r => setTimeout(r, 100));

                    const canvas = await html2canvas(printRef.current, {
                        scale: 3, // High resolution
                        useCORS: true,
                        backgroundColor: "#ffffff"
                    });

                    if (format === 'pdf') {
                        const { jsPDF } = window.jspdf;
                        // A4 Portrait: 210mm x 297mm
                        const doc = new jsPDF('p', 'mm', 'a4');
                        const imgData = canvas.toDataURL('image/jpeg', 1.0);
                        
                        // We want it to fit on the top half.
                        // Canvas width (px) -> A4 width (mm) conversion
                        const pageWidth = 210;
                        const pageHeight = 297;
                        
                        // Calculate dimensions to maintain aspect ratio
                        const canvasRatio = canvas.width / canvas.height;
                        const printWidth = pageWidth - 20; // 10mm margin each side
                        const printHeight = printWidth / canvasRatio;

                        // Center horizontally, position at top (with margin)
                        doc.addImage(imgData, 'JPEG', 10, 10, printWidth, printHeight);
                        doc.save('project-collage.pdf');
                    } else {
                        const link = document.createElement('a');
                        link.download = `project-collage.${format}`;
                        link.href = canvas.toDataURL(`image/${format}`, 1.0);
                        link.click();
                    }
                } catch (e) {
                    console.error(e);
                    alert("Error generating file. Please check console.");
                } finally {
                    setIsGenerating(false);
                }
            };

            return (
                <div className="flex flex-col items-center py-8 px-4">
                    
                    {/* Header Instructions */}
                    <div className="mb-6 text-center max-w-lg">
                        <h1 className="text-2xl font-bold mb-2">Project Collage Maker</h1>
                        <p className="text-sm text-gray-500">
                            Fills the top half of an A4 page. Click boxes to add photos. Click text to edit.
                        </p>
                    </div>

                    {/* --- THE CANVAS (VISUAL EDITOR) --- */}
                    {/* A4 width is approx 210mm. 
                        We simulate pixels: 794px width (standard screen representation of A4 width).
                        We want the content to be roughly half height (~560px).
                    */}
                    <div className="shadow-2xl overflow-hidden border border-gray-300 bg-white">
                        <div 
                            ref={printRef}
                            style={{ width: '794px', height: 'auto', minHeight: '560px' }}
                            className="bg-white p-8 flex flex-col items-center"
                        >
                            {/* The Black Border Box */}
                            <div className="w-full border-2 border-black p-4 flex flex-col h-full">
                                
                                {/* 1. Top Image (Panoramic) */}
                                <div className="mb-4">
                                    <ImageBox 
                                        id="main" 
                                        aspectRatio="3.5/1" 
                                        image={images.main} 
                                        label={labels.main}
                                        onUpload={handleUpload}
                                        onLabelChange={handleLabelChange}
                                    />
                                </div>

                                {/* 2. The 2x3 Grid */}
                                <div className="grid grid-cols-3 gap-x-2 gap-y-4 mb-6">
                                    <ImageBox id="g1" aspectRatio="3/4" image={images.g1} label={labels.g1} onUpload={handleUpload} onLabelChange={handleLabelChange} />
                                    <ImageBox id="g2" aspectRatio="3/4" image={images.g2} label={labels.g2} onUpload={handleUpload} onLabelChange={handleLabelChange} />
                                    <ImageBox id="g3" aspectRatio="3/4" image={images.g3} label={labels.g3} onUpload={handleUpload} onLabelChange={handleLabelChange} />
                                    
                                    <ImageBox id="g4" aspectRatio="3/4" image={images.g4} label={labels.g4} onUpload={handleUpload} onLabelChange={handleLabelChange} />
                                    <ImageBox id="g5" aspectRatio="3/4" image={images.g5} label={labels.g5} onUpload={handleUpload} onLabelChange={handleLabelChange} />
                                    <ImageBox id="g6" aspectRatio="3/4" image={images.g6} label={labels.g6} onUpload={handleUpload} onLabelChange={handleLabelChange} />
                                </div>

                                {/* 3. Footer Information */}
                                <div className="mt-auto space-y-4 text-center">
                                    {/* Group & Roll */}
                                    <div className="flex justify-center items-center gap-2 font-hand text-xl font-bold">
                                        <input 
                                            value={footer.group}
                                            onChange={(e) => setFooter({...footer, group: e.target.value})}
                                            className="text-right w-32 bg-transparent focus:outline-none border-b border-transparent hover:border-gray-200"
                                        />
                                        <span>:</span>
                                        <input 
                                            value={footer.roll}
                                            onChange={(e) => setFooter({...footer, roll: e.target.value})}
                                            className="text-left flex-1 bg-transparent focus:outline-none border-b border-transparent hover:border-gray-200"
                                        />
                                    </div>

                                    {/* Project Description */}
                                    <textarea 
                                        value={footer.desc}
                                        onChange={(e) => setFooter({...footer, desc: e.target.value})}
                                        rows="3"
                                        className="w-full text-center font-hand text-lg uppercase tracking-wide leading-relaxed bg-transparent focus:outline-none resize-none overflow-hidden"
                                    />
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Action Buttons */}
                    <div className="fixed bottom-6 flex gap-3 z-50">
                        <button 
                            onClick={() => handleDownload('jpeg')}
                            disabled={isGenerating}
                            className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-full shadow-lg transition transform hover:scale-105"
                        >
                            Save JPG
                        </button>
                        <button 
                            onClick={() => handleDownload('png')}
                            disabled={isGenerating}
                            className="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-full shadow-lg transition transform hover:scale-105"
                        >
                            Save PNG
                        </button>
                        <button 
                            onClick={() => handleDownload('pdf')}
                            disabled={isGenerating}
                            className="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-full shadow-lg transition transform hover:scale-105"
                        >
                            Save PDF
                        </button>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


